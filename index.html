<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PageDown Demo Page</title>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<script type="text/javascript" src="js/Markdown.Converter.js"></script>
<script type="text/javascript" src="js/Markdown.Sanitizer.js"></script>
<script type="text/javascript" src="js/Markdown.Editor.js"></script>
<style>
html, body {margin:0;padding:0;}
</style>
</head>
<body>
<div class="editor editMode" id="editor">
    <div class="editor-toolbar" id="wmd-button-bar-desc"></div>
    <div class="wmd">
        <textarea class="wmd-input" id="wmd-input-desc"></textarea>
        <div class="wmd-preview">
            <div class="wmd-preview-cont" id="wmd-preview-desc"></div>    
        </div>
    </div>
    <div class="editor-resize">调整高度</div>
</div>
<script type="text/javascript">
(function () {
    var converter = new Markdown.Converter();
    // converter.hooks.chain("preBlockGamut", function (text, rbg) {
    //     return text.replace(/^ {0,3}""" *\n((?:.*?\n)+?) {0,3}""" *$/gm, function (whole, inner) {
    //         return "<blockquote>" + rbg(inner) + "</blockquote>\n";
    //     });
    // });
    // 插件机制：
    // preConversion/postConversion 文本处理前/后触发
    // plainLinkText 处理有效链接字符串时触发
    // preBlockGamut/postNormalization 文本一般化处理前/后触发
    // preSpanGamut/postBlockGamut 在处理区块级MD代码前后触发，后者在处理完 List/Code block/Block Quote 之后，抽取HTML代码之前触发
    // preSpanGamut/postSpanGamut 处理行内级MD代码前后触发
    converter.hooks.chain("preConversion", function (text) {
        return text.replace(/\b(a\w*)/gi, "*$1*");
    });
    converter.hooks.chain("plainLinkText", function (url) {
        return "This is a link to " + url.replace(/^https?:\/\//, "");
    });

    var editor = new Markdown.Editor(converter, "-desc", {
            helpButton: {
                title: 'Markdown 语法',
                handler: function() {
                    alert("详查 Markdown 语法");
                }
            },
            strings: {
                bold: "加粗 <strong> Ctrl+B",
                boldexample: "加粗文字",
                italic: "斜体 <em> Ctrl+I",
                italicexample: "斜体文字",
                link: "链接 <a> Ctrl+L",
                linkdescription: "enter link description here",
                linkdialog: '插入链接',
                quote: "引用 <blockquote> Ctrl+Q",
                quoteexample: "引用文字",
                code: "代码 <pre><code> Ctrl+K",
                codeexample: "请输入代码",
                image: "图片 <img> Ctrl+G",
                imagedescription: "enter image description here",
                imagedialog: "<p>插入图片</p>",
                olist: "有序列表 <ol> Ctrl+O",
                ulist: "普通列表 <ul> Ctrl+U",
                litem: "列表项目",
                heading: "标题 <h1>/<h2> Ctrl+H",
                headingexample: "标题文字",
                hr: "分割线 <hr> Ctrl+R",
                undo: "撤销 - Ctrl+Z",
                redo: "重做 - Ctrl+Y",
                redomac: "重做 - Ctrl+Shift+Z",
                help: "Markdown 语法",
                fullscreen: "全屏",
                editmode: '编辑模式',
                livemode: '实时模式',
                previewmode: "预览模式"
            }
        });
    // onPreviewRefresh | postBlockquoteCreation | insertImageDialog
    editor.run();
    // editor.getConverter();
    // editor.refreshPreview();
    var dom = document.getElementById('editor');
    document.getElementById('wmd-editmode-button-desc').addEventListener('click', function() {
        // dom.classList.remove('editMode');
        dom.classList.remove('liveMode');
        dom.classList.remove('previewMode');
        dom.classList.add('editMode');
    }, false);
    document.getElementById('wmd-livemode-button-desc').addEventListener('click', function() {
        dom.classList.remove('editMode');
        // dom.classList.remove('liveMode');
        dom.classList.remove('previewMode');
        dom.classList.add('liveMode');
    }, false);
    document.getElementById('wmd-previewmode-button-desc').addEventListener('click', function() {
        dom.classList.remove('editMode');
        dom.classList.remove('liveMode');
        // dom.classList.remove('previewMode');
        dom.classList.add('previewMode');
    }, false);
    document.getElementById('wmd-fullscreen-button-desc').addEventListener('click', function() {
        dom.classList.toggle('fullscreenMode');
    }, false);

    console.log(editor)
})();
</script>
</body>
</html>
